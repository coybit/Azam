<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="http://v4-alpha.getbootstrap.com/favicon.ico">

    <title>Azam</title>
    <link href="http://v4-alpha.getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://v4-alpha.getbootstrap.com/examples/signin/signin.css" rel="stylesheet">
    <script src="http://v4-alpha.getbootstrap.com/assets/js/ie10-viewport-bug-workaround.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <style media="screen">
    .movie {
        margin: 10px;
        background: #f7f7f7;
        padding: 16px;
        border-radius: 4px;
        box-shadow: 1px 1px 1px #ccc;
    }

    .movie-title {
        font-size: 28px;
        float: left;
    }

    .movie-rate {
        font-size: 20px;
        float: right;
    }

    .movie-image {
        height: 200px;
        float: left;
        padding-right: 32px;
    }

    .clearfix::after {
        content: " ";
        display: block;
        height: 0;
        clear: both;
    }

    .search-box {
        width: 100%;
        height: 40px;
        padding: 0 10px;
    }

    </style>
</head>

<body>

    <div class="container">

        <div class="row">
            <div class="col-lg-12">
                <input type="text" placeholder="Search..." class="search-box"/>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div id="list"></div>
            </div>
        </div>

    </div> <!-- /container -->

    <script type="text/javascript">

    var movies = [];

    $.get( 'out.json', function(res) {

        movies = res;
        load('');

    })

    ///////// Event Handlers
    $('.search-box').on('keyup', function() {
        var term = $('.search-box').val();
        console.log(term.toLowerCase());
        load(term);
    });


    ///////// Utilities

    function load(term) {

        list = movies.map(function(movie){

            var rate = [0];

            if( movie.info.Ratings ) {
                rate = movie.info.Ratings.filter(function(rate){
                    return rate.Source == "Internet Movie Database"
                }).map( function(rate) { return rate.Value });
            }

            if( rate.length == 0 ) {
                rate = [0];
            }

            return {
                "title":movie.info.Title,
                "rate":rate[0],
                "image": movie.info.Poster
            }
        })
        .filter( function(movie) {
            return movie.title != null;
        })
        .filter( function(movie) {
            return term=='' || movie.title.toLowerCase().indexOf(term) >= 0;
        });



        // Add movies into the list

        $('#list').html('');

        list.forEach( function(item) {

            var elmImage = $('<img>').addClass('movie-image').attr('src',item.image);
            var elmTitle = $('<span>').addClass('movie-title').text(item.title);
            var elmScore = $('<span>').addClass('movie-rate').text(item.rate);
            var elm = $('<div>').addClass('movie clearfix').append(elmImage).append(elmTitle).append(elmScore);
            $('#list').append( elm );

        });

    }

    </script>

</body>
</html>
